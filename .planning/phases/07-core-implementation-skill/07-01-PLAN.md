---
phase: 07-core-implementation-skill
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/entity-translation-setup/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Skill triggers when user asks to make entity translatable"
    - "AI announces skill activation before starting workflow"
    - "User can choose quick mode (defaults) or guided mode (walkthrough)"
    - "Generated code shows diff-style with + markers and inline comments"
    - "Attribute decisions presented with examples-first (not concepts-first)"
    - "Changes applied only after user confirmation"
  artifacts:
    - path: ".claude/skills/entity-translation-setup/SKILL.md"
      provides: "Complete workflow for making entities translatable"
      contains: "entity-translation-setup"
      max_lines: 200
  key_links:
    - from: "SKILL.md frontmatter description"
      to: "skill auto-trigger"
      via: "trigger phrases in description"
      pattern: "make.*entity translatable|add translations to"
    - from: "SKILL.md workflow"
      to: "llms.md"
      via: "reference for handler chain details"
      pattern: "llms\\.md"
---

<objective>
Create the entity-translation-setup Claude Code skill that guides users through making any Doctrine entity translatable with correct interface implementation, trait usage, and attribute configuration.

Purpose: Enable AI assistants to help users implement translations correctly on first try by providing a structured workflow with examples-first guidance.

Output: `.claude/skills/entity-translation-setup/SKILL.md` under 200 lines
</objective>

<execution_context>
@C:\Users\info\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\info\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-core-implementation-skill/07-CONTEXT.md
@.planning/phases/07-core-implementation-skill/07-RESEARCH.md
@llms.md
@src/Doctrine/Model/TranslatableTrait.php
@src/Doctrine/Model/TranslatableInterface.php
@src/Doctrine/Attribute/SharedAmongstTranslations.php
@src/Doctrine/Attribute/EmptyOnTranslate.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create entity-translation-setup skill</name>
  <files>.claude/skills/entity-translation-setup/SKILL.md</files>
  <action>
Create the skill directory and SKILL.md file with these components:

**Frontmatter (YAML):**
```yaml
---
name: entity-translation-setup
description: Guide users through making Doctrine entities translatable with TranslatableInterface, TranslatableTrait, and attribute configuration. Use when user asks to "make this entity translatable", "add translations to [Entity]", "translate [Entity] fields", or needs help implementing multilingual entities with the TMI Translation Bundle.
---
```

**Body structure (Markdown, under 200 lines total):**

1. **Activation section:**
   - Announce: "I'll use the entity-translation-setup skill to guide you through this."
   - Ask mode: "Want me to use defaults (quick mode), or walk through each decision?"

2. **Step 1: Read Entity**
   - Read the entity file user specified
   - Parse fields by type (scalars, relations, embedded)
   - Hide non-translatable fields (IDs, timestamps, generated values)

3. **Step 2: Explain TranslatableTrait (brief)**
   - What the trait provides: tuuid, locale, translations
   - Note: tuuid already marked SharedAmongstTranslations
   - "You don't add these - the trait provides them"

4. **Quick Mode section:**
   - Defaults: translate all scalars except price/cost/amount, share all relations
   - Skip EmptyOnTranslate unless "slug" in field name
   - Show diff, ask confirmation, apply

5. **Guided Mode section:**
   - 2.1: Show grouped fields, ask which to translate
   - 2.2: SharedAmongstTranslations examples-first:
     * Product SKU: same in all languages
     * Price: $999 regardless of language
     * Creation date: timestamp same across locales
     * Category: same category for all locales
   - 2.3: EmptyOnTranslate examples-first (optional):
     * Slug: needs new value per locale
     * SEO URL: must be regenerated
   - 2.4: Auto-detect relationships, ask about translation

6. **Step 3: Generate Diff**
   - Template showing diff-style output with + markers
   - Inline comments explaining each change
   - Include import statements for bundle classes

7. **Step 4: Confirm and Apply**
   - "Apply these changes?"
   - Wait for user confirmation
   - After apply: "Run migration: `bin/console doctrine:migrations:diff`"

8. **Reference section:**
   - "For handler chain details, see llms.md 'Handler Chain Decision Tree' section"

**Critical implementation details:**
- Use compact formatting to stay under 200 lines
- Diff template should be a single code block with placeholders
- Smart field suggestions: price/cost/amount -> SharedAmongstTranslations, slug/seoUrl -> EmptyOnTranslate
- Do NOT duplicate handler chain content from llms.md - just reference it
  </action>
  <verify>
1. File exists: `.claude/skills/entity-translation-setup/SKILL.md`
2. Line count: `wc -l .claude/skills/entity-translation-setup/SKILL.md` shows under 200
3. Frontmatter valid: Contains name and description fields
4. Description includes trigger phrases: "make this entity translatable", "add translations"
5. Body includes: Quick Mode, Guided Mode, diff template, migration command
  </verify>
  <done>
Skill file exists with:
- Valid YAML frontmatter with trigger phrases in description
- Under 200 lines total
- Activation announcement
- Quick mode and guided mode workflows
- Examples-first attribute guidance
- Diff-style code template
- User confirmation step
- Migration command reminder
- Reference to llms.md for handler details
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate skill structure and content</name>
  <files>.claude/skills/entity-translation-setup/SKILL.md</files>
  <action>
Verify the skill meets all requirements from CONTEXT.md and RESEARCH.md:

1. **Structure validation:**
   - YAML frontmatter with --- delimiters
   - name field matches directory name
   - description field present and comprehensive

2. **Trigger phrase coverage:**
   - "make this entity translatable"
   - "add translations to [Entity]"
   - "translate [Entity] fields"

3. **Workflow completeness check:**
   - [ ] Activation announcement present
   - [ ] Mode selection (quick vs guided) present
   - [ ] TranslatableTrait explanation present
   - [ ] Field grouping by type mentioned
   - [ ] SharedAmongstTranslations examples (SKU, price, date, category)
   - [ ] EmptyOnTranslate examples (slug, SEO URL)
   - [ ] Relationship auto-detection mentioned
   - [ ] Diff template with + markers present
   - [ ] User confirmation before apply
   - [ ] Migration command: `bin/console doctrine:migrations:diff`
   - [ ] Reference to llms.md handler chain

4. **Line count verification:**
   - Must be under 200 lines per user requirement
   - If over, condense by removing redundancy or using more compact formatting

5. **Content accuracy check:**
   - Import paths match actual bundle structure:
     * `Tmi\TranslationBundle\Doctrine\Model\TranslatableInterface`
     * `Tmi\TranslationBundle\Doctrine\Model\TranslatableTrait`
     * `Tmi\TranslationBundle\Doctrine\Attribute\SharedAmongstTranslations`
     * `Tmi\TranslationBundle\Doctrine\Attribute\EmptyOnTranslate`
   - Trait provides tuuid, locale, translations (from actual TranslatableTrait.php)
  </action>
  <verify>
Run validation checks:
1. `head -10 .claude/skills/entity-translation-setup/SKILL.md` - shows valid frontmatter
2. `wc -l .claude/skills/entity-translation-setup/SKILL.md` - under 200 lines
3. `grep -c "make.*translatable\|add translations" .claude/skills/entity-translation-setup/SKILL.md` - at least 1 match
4. `grep -c "SharedAmongstTranslations\|EmptyOnTranslate" .claude/skills/entity-translation-setup/SKILL.md` - both attributes mentioned
5. `grep -c "llms.md" .claude/skills/entity-translation-setup/SKILL.md` - reference exists
  </verify>
  <done>
Skill validated:
- Frontmatter is valid YAML with correct fields
- Under 200 lines
- All trigger phrases present in description
- Both workflow modes implemented
- All required examples included
- Correct import paths
- Reference to llms.md present
  </done>
</task>

</tasks>

<verification>
Phase verification:

1. **Requirement SKILL-01 coverage:**
   - [x] entity-translation-setup skill exists
   - [x] SKILL.md under 200 lines
   - [x] Working code templates for TranslatableInterface
   - [x] Guides through attribute decisions
   - [x] References llms.md for handler details

2. **User decisions honored (from CONTEXT.md):**
   - [x] Auto-activate triggers in description
   - [x] Activation announcement
   - [x] Quick mode vs guided mode choice
   - [x] Diff-style code presentation
   - [x] Examples-first attribute guidance
   - [x] User confirmation before apply
   - [x] Migration command shown after

3. **Structure validation:**
   - Skill location: `.claude/skills/entity-translation-setup/SKILL.md`
   - Frontmatter fields: name, description
   - Under 200 lines
</verification>

<success_criteria>
- `.claude/skills/entity-translation-setup/SKILL.md` exists
- File is under 200 lines
- Frontmatter contains trigger phrases for auto-activation
- Workflow includes quick mode and guided mode
- SharedAmongstTranslations examples: SKU, price, date, category
- EmptyOnTranslate examples: slug, SEO URL
- Diff-style code template with + markers present
- User confirmation step included
- Migration command reminder included
- llms.md referenced for handler chain details
</success_criteria>

<output>
After completion, create `.planning/phases/07-core-implementation-skill/07-01-SUMMARY.md`
</output>
