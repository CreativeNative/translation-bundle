---
phase: 06-foundation-documentation
plan: 02
type: execute
wave: 2
depends_on:
  - "06-01"
files_modified:
  - llms.md
autonomous: true

must_haves:
  truths:
    - "AI assistants can match user-reported errors to troubleshooting entries and provide diagnostic steps"
    - "AI assistants can guide users through entity-to-translatable transformation using the minimal example"
    - "Users understand WHY each change is needed, not just WHAT to change"
  artifacts:
    - path: "llms.md"
      provides: "Troubleshooting section with 8-10 entries"
      contains: "## Troubleshooting"
    - path: "llms.md"
      provides: "Minimal working example walkthrough"
      contains: "## Minimal Working Example"
  key_links:
    - from: "llms.md troubleshooting"
      to: "handler decision tree"
      via: "handler references in diagnostics"
      pattern: "Handler|priority"
    - from: "llms.md minimal example"
      to: "glossary terms"
      via: "uses defined terminology"
      pattern: "Tuuid|translatable entity|TranslatableInterface"
---

<objective>
Add troubleshooting section and minimal working example to llms.md

Purpose: Enable AI assistants to diagnose common issues and guide users through their first translatable entity implementation
Output: llms.md with Troubleshooting section (8-10 entries) and Minimal Working Example section (Product entity narrative walkthrough)
</objective>

<execution_context>
@C:\Users\info\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\info\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-foundation-documentation/06-CONTEXT.md
@.planning/phases/06-foundation-documentation/06-RESEARCH.md
@.planning/phases/06-foundation-documentation/06-01-SUMMARY.md
@llms.md
@.claude/architecture.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Troubleshooting Section</name>
  <files>llms.md</files>
  <action>
Add a "## Troubleshooting" section to llms.md (after Handler Chain Decision Tree, before Tips & Best Practices).

Include 8-10 entries covering BOTH setup mistakes AND runtime surprises. Structure each entry based on problem type:
- For errors with clear messages: Symptom -> Cause -> Fix
- For behavioral issues: Symptom -> Diagnosis Steps -> Resolution

Required entries (from RESEARCH.md analysis):

**Setup Mistakes (4-5 entries):**

1. **Locale not allowed**
   - Symptom: `LogicException: Locale "xx" is not allowed`
   - Cause: Target locale not configured in bundle
   - Fix: Add locale to `tmi_translation.locales` in config

2. **EmptyOnTranslate on non-nullable field**
   - Symptom: `LogicException: cannot use EmptyOnTranslate because it is not nullable`
   - Cause: `#[EmptyOnTranslate]` on non-nullable property
   - Fix: Make property nullable (`?string`) or remove attribute

3. **Missing TranslatableInterface**
   - Symptom: Entity not recognized by TranslatableEntityHandler
   - Cause: Entity class does not implement `TranslatableInterface`
   - Fix: Add `implements TranslatableInterface` and `use TranslatableTrait`

4. **Missing Tuuid property**
   - Symptom: Translation fails with null tuuid
   - Cause: TranslatableTrait expects `$tuuid` property but entity lacks proper setup
   - Fix: Ensure trait is used and `$tuuid` is initialized in constructor or via setter

5. **Doctrine filter not enabled**
   - Symptom: Queries return all locales instead of current locale
   - Cause: Translation filter not enabled in Doctrine configuration
   - Fix: Enable filter in doctrine.yaml or via EntityManager

**Runtime Surprises (4-5 entries):**

6. **SharedAmongstTranslations on bidirectional relation**
   - Symptom: `RuntimeException` when translating
   - Cause: Bidirectional handlers throw when `#[SharedAmongstTranslations]` is present
   - Fix: Remove `#[SharedAmongstTranslations]` from bidirectional relations; use unidirectional or accept per-locale copies

7. **Translations not persisted**
   - Symptom: Translation appears to work but entity not in database
   - Diagnosis: Check if `persist()` and `flush()` called on translated entity
   - Resolution: Always persist translated entity; it's a NEW entity, not an update

8. **Wrong handler processes field**
   - Symptom: Field value unexpected after translation (null when should have value, or vice versa)
   - Diagnosis: Check handler priority order; more specific handlers must have higher priority
   - Resolution: Verify Doctrine mapping annotations are correct; handler selection depends on metadata

9. **Embedded object shared unexpectedly**
   - Symptom: Changing embedded value on one locale changes all locales
   - Cause: `#[SharedAmongstTranslations]` on embedded property shares the instance
   - Resolution: Remove attribute if per-locale values needed; keep if sharing is intentional

10. **Collection translation creates duplicates**
    - Symptom: OneToMany collection has duplicate items after translation
    - Diagnosis: Check if collection items implement TranslatableInterface
    - Resolution: Ensure child entities are translatable OR use `#[SharedAmongstTranslations]` to reuse same collection

Include actual error messages where possible (from test analysis). Skip code snippets for config-only fixes.
  </action>
  <verify>
Grep for "## Troubleshooting" in llms.md.
Count entries: should be 8-10 (grep for "###" within troubleshooting section).
  </verify>
  <done>
Troubleshooting section has 8-10 entries covering both setup mistakes and runtime surprises. Each entry has clear symptom, cause/diagnosis, and fix/resolution.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Minimal Working Example</name>
  <files>llms.md</files>
  <action>
Add a "## Minimal Working Example" section to llms.md (after Troubleshooting, before existing "Practical Usage Scenarios").

Use narrative structure: "You have a Product entity. To make it translatable, first..."

**Starting Point (BEFORE):**

```php
#[ORM\Entity]
class Product
{
    #[ORM\Id]
    #[ORM\GeneratedValue]
    #[ORM\Column]
    private ?int $id = null;

    #[ORM\Column(length: 255)]
    private string $name;

    #[ORM\Column(type: Types::TEXT)]
    private string $description;

    #[ORM\Column(type: Types::DECIMAL, precision: 10, scale: 2)]
    private string $price;

    #[ORM\ManyToOne(targetEntity: Category::class, inversedBy: 'products')]
    private ?Category $category = null;

    // getters/setters...
}
```

**Transformation Steps (with WHY for each):**

1. **Add the interface and trait**
   - WHY: TranslatableInterface tells the bundle this entity can be translated. TranslatableTrait provides the `$tuuid`, `$locale`, and `$translations` properties automatically.

2. **Identify shared fields**
   - Price: Same in all languages (unless you have locale-specific pricing)
   - Category: Same category for all translations (product belongs to one category regardless of language)
   - WHY: SharedAmongstTranslations prevents duplicate data and keeps related translations in sync.

3. **Identify translated fields**
   - Name: Different per locale ("Laptop" in English, "Ordinateur portable" in French)
   - Description: Different per locale
   - WHY: Default behavior - no attribute needed. Handler chain clones/translates these fields.

**End Result (AFTER):**

```php
use Tmi\TranslationBundle\Doctrine\Attribute\SharedAmongstTranslations;
use Tmi\TranslationBundle\Doctrine\Model\TranslatableInterface;
use Tmi\TranslationBundle\Doctrine\Model\TranslatableTrait;

#[ORM\Entity]
class Product implements TranslatableInterface
{
    use TranslatableTrait;

    #[ORM\Id]
    #[ORM\GeneratedValue]
    #[ORM\Column]
    private ?int $id = null;

    #[ORM\Column(length: 255)]
    private string $name;           // Translated per locale

    #[ORM\Column(type: Types::TEXT)]
    private string $description;    // Translated per locale

    #[SharedAmongstTranslations]
    #[ORM\Column(type: Types::DECIMAL, precision: 10, scale: 2)]
    private string $price;          // Same across all locales

    #[SharedAmongstTranslations]
    #[ORM\ManyToOne(targetEntity: Category::class, inversedBy: 'products')]
    private ?Category $category = null;  // Same category for all locales

    // getters/setters remain unchanged
}
```

**Usage Example:**

```php
// Create translation
$frenchProduct = $entityTranslator->translate($product, 'fr');
$entityManager->persist($frenchProduct);
$entityManager->flush();

// Both share the same Tuuid
$product->getTuuid() === $frenchProduct->getTuuid(); // true
```

Keep example focused on Product + Category only. Do NOT add ManyToMany, embedded objects, or other complexity. Those belong in Advanced sections.

Explain the "why" behind each change - rationale for interface (signals to bundle), trait (provides required properties), Tuuid (groups variants), attributes (controls field behavior).
  </action>
  <verify>
Grep for "## Minimal Working Example" in llms.md.
Verify BEFORE and AFTER code blocks exist.
Verify "WHY" explanations are present (grep for "WHY:" or narrative explaining rationale).
  </verify>
  <done>
Minimal example shows complete Product entity transformation with narrative explaining WHY each change is needed. Example includes ManyToOne Category relationship demonstrating SharedAmongstTranslations on relations.
  </done>
</task>

</tasks>

<verification>
- llms.md contains "## Troubleshooting" section with 8-10 entries
- llms.md contains "## Minimal Working Example" section
- Troubleshooting entries include actual error messages where applicable
- Minimal example includes BEFORE and AFTER code with rationale
- All new content uses glossary terminology consistently
</verification>

<success_criteria>
1. Troubleshooting section has 8-10 entries covering setup + runtime issues
2. Each troubleshooting entry has symptom -> cause/diagnosis -> fix/resolution structure
3. Minimal example walks through Product entity transformation narratively
4. Example explains WHY for each step (interface, trait, attributes)
5. Example demonstrates SharedAmongstTranslations on both scalar (price) and relation (category)
</success_criteria>

<output>
After completion, create `.planning/phases/06-foundation-documentation/06-02-SUMMARY.md`
</output>
