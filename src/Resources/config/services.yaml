services:
    TMI\TranslationBundle\Translation\EntityTranslator: '@tmi_translation.translation.entity_translator'

    tmi_translation.translation.entity_translator:
        class: TMI\TranslationBundle\Translation\EntityTranslator
        arguments:
            - '%tmi_translation.locales%'
            - '@event_dispatcher'
            - '@tmi_translation.utils.attribute_helper'
        public: true # This is just for testing purpose

    # Utils
    tmi_translation.utils.attribute_helper:
        class: TMI\TranslationBundle\Utils\AttributeHelper

    # Translation Handlers
    ## Embedded
    tmi_translation.translation.handlers.embedded_key_handler:
        class: TMI\TranslationBundle\Translation\Handlers\EmbeddedHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation_handlers.doctrine_object_handler'
        tags:
            - { name: tmi_translation.translation_handler, priority: 10 }

    ## PrimaryKey
    tmi_translation.translation.handlers.primary_key_handler:
        class: TMI\TranslationBundle\Translation\Handlers\PrimaryKeyHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
        tags:
            - { name: tmi_translation.translation_handler, priority: 20 }

    ## Bidirectional OneToMany (parent)
    tmi_translation.translation_handlers.bidirectional_one_to_many_handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalOneToManyHandler
        tags:
            - { name: tmi_translation.translation_handler, priority: 30 }
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation.entity_translator'
            - '@doctrine.orm.entity_manager'

    ## Bidirectional ManyToOne (children)
    tmi_translation.translation_handlers.bidirectional_many_to_one_handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalManyToOneHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@doctrine.orm.entity_manager'
            - '@property_accessor'
            - '@tmi_translation.translation.entity_translator'
        tags:
            - { name: tmi_translation.translation_handler, priority: 35 }

    ## Collection (bidirectional ManyToMany)
    tmi_translation.translation.handlers.collection_handler:
        class: TMI\TranslationBundle\Translation\Handlers\CollectionHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation.entity_translator'
        tags:
            - { name: tmi_translation.translation_handler, priority: 40 }

    ## Scalar
    tmi_translation.translation.handlers.scalar_handler:
        class: TMI\TranslationBundle\Translation\Handlers\ScalarHandler
        tags:
            - { name: tmi_translation.translation_handler, priority: 50 }

    ## Bidirectional ManyToMany
    tmi_translation.translation_handlers.bidirectional_association_handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalAssociationHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@property_accessor'
            - '@tmi_translation.utils.attribute_helper'
        tags:
            - { name: tmi_translation.translation_handler, priority: 60 }

    ## Unidirectional ManyToMany
    tmi_translation.translation_handlers.unidirectional_many_to_many_handler:
        class: TMI\TranslationBundle\Translation\Handlers\UnidirectionalManyToManyHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation.entity_translator'
            - '@doctrine.orm.entity_manager'
        tags:
            - { name: tmi_translation.translation_handler }

    ## Translatable Entity
    tmi_translation.translation_handlers.translatable_entity_handler:
        class: TMI\TranslationBundle\Translation\Handlers\TranslatableEntityHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation_handlers.doctrine_object_handler'
        tags:
            - { name: tmi_translation.translation_handler, priority: 70 }

    ## Doctrine Object
    tmi_translation.translation_handlers.doctrine_object_handler:
        class: TMI\TranslationBundle\Translation\Handlers\DoctrineObjectHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation.entity_translator'
            - '@tmi_translation.utils.attribute_helper'
        tags:
            - { name: tmi_translation.translation_handler, priority: 100 }

    tmi_translation.twig.tmi_translation_extension:
        class: TMI\TranslationBundle\Twig\TMITranslationExtension
        arguments: ['%tmi_translation.locales%']
        tags:
            - { name: twig.extension }

    tmi_translation.doctrine.event_subscriber.translatable_event_subscriber:
        class: TMI\TranslationBundle\Doctrine\EventSubscriber\TranslatableEventSubscriber
        lazy: true
        arguments:
            - '%tmi_translation.default_locale%'
        calls:
            - { method: 'setEntityTranslator', arguments: ['@tmi_translation.translation.entity_translator'] }
        tags:
            - { name: doctrine.event_subscriber }

    tmi_translation.event_subscriber.locale_filter_configurator:
        class: TMI\TranslationBundle\EventSubscriber\LocaleFilterConfigurator
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%tmi_translation.disabled_firewalls%'
            - '@?security.firewall.map'
        tags:
            - { name: kernel.event_subscriber }

    tmi_translation.event_subscriber.easy_admin_action_customisation_subscriber:
        class: TMI\TranslationBundle\EventSubscriber\EasyAdminActionCustomisationSubscriber
        arguments:
            - '@doctrine.orm.entity_manager'
        tags:
            - { name: kernel.event_subscriber }
