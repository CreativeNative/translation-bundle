services:
    # EntityTranslator
    TMI\TranslationBundle\Translation\EntityTranslator:
        class: TMI\TranslationBundle\Translation\EntityTranslator
        arguments:
            $defaultLocale: '%tmi_translation.default_locale%'
            $locales: '%tmi_translation.locales%'
            $eventDispatcher: '@event_dispatcher'
            $attributeHelper: '@tmi_translation.utils.attribute_helper'
        public: true
        autowire: true

    tmi_translation.translation.entity_translator:
        alias: TMI\TranslationBundle\Translation\EntityTranslator

    # Utils
    tmi_translation.utils.attribute_helper:
        class: TMI\TranslationBundle\Utils\AttributeHelper
        public: true

    # Translation Handlers
    ## Embedded
    tmi_translation.translation.handlers.embedded_key_handler:
        class: TMI\TranslationBundle\Translation\Handlers\EmbeddedHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation_handlers.doctrine_object_handler'
        tags:
            - { name: tmi_translation.translation_handler, priority: 10 }

    ## PrimaryKey
    tmi_translation.translation.handlers.primary_key_handler:
        class: TMI\TranslationBundle\Translation\Handlers\PrimaryKeyHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
        tags:
            - { name: tmi_translation.translation_handler, priority: 20 }

    ## Bidirectional OneToMany (parent)
    tmi_translation.translation_handlers.bidirectional_one_to_many_handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalOneToManyHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation.entity_translator'
            - '@doctrine.orm.entity_manager'
        tags:
            - { name: tmi_translation.translation_handler, priority: 30 }

    ## Bidirectional ManyToOne (children)
    tmi_translation.translation_handlers.bidirectional_many_to_one_handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalManyToOneHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@doctrine.orm.entity_manager'
            - '@property_accessor'
            - '@tmi_translation.translation.entity_translator'
        tags:
            - { name: tmi_translation.translation_handler, priority: 35 }

    ## Collection (bidirectional ManyToMany)
    tmi_translation.translation.handlers.collection_handler:
        class: TMI\TranslationBundle\Translation\Handlers\CollectionHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation.entity_translator'
        tags:
            - { name: tmi_translation.translation_handler, priority: 40 }

    ## Scalar
    tmi_translation.translation.handlers.scalar_handler:
        class: TMI\TranslationBundle\Translation\Handlers\ScalarHandler
        tags:
            - { name: tmi_translation.translation_handler, priority: 50 }

    ## Bidirectional OneToOne
    tmi_translation.translation_handlers.bidirectional_one_to_one__handler:
        class: TMI\TranslationBundle\Translation\Handlers\BidirectionalOneToOneHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@property_accessor'
            - '@tmi_translation.utils.attribute_helper'
        tags:
            - { name: tmi_translation.translation_handler, priority: 60 }

    ## Unidirectional ManyToMany
    tmi_translation.translation_handlers.unidirectional_many_to_many_handler:
        class: TMI\TranslationBundle\Translation\Handlers\UnidirectionalManyToManyHandler
        arguments:
            - '@tmi_translation.utils.attribute_helper'
            - '@tmi_translation.translation.entity_translator'
            - '@doctrine.orm.entity_manager'
        tags:
            - { name: tmi_translation.translation_handler }

    ## Translatable Entity
    tmi_translation.translation_handlers.translatable_entity_handler:
        class: TMI\TranslationBundle\Translation\Handlers\TranslatableEntityHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation_handlers.doctrine_object_handler'
        tags:
            - { name: tmi_translation.translation_handler, priority: 70 }

    ## Doctrine Object
    tmi_translation.translation_handlers.doctrine_object_handler:
        class: TMI\TranslationBundle\Translation\Handlers\DoctrineObjectHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@tmi_translation.translation.entity_translator'
            - '@?property_accessor'
        tags:
            - { name: tmi_translation.translation_handler, priority: 100 }

    # Twig
    tmi_translation.twig.tmi_translation_extension:
        class: TMI\TranslationBundle\Twig\TmiTranslationExtension
        arguments: ['%tmi_translation.locales%']
        tags:
            - { name: twig.extension }

    # Event Subscriber
    tmi_translation.event_subscriber.locale_filter_configurator:
        class: TMI\TranslationBundle\EventSubscriber\LocaleFilterConfigurator
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%tmi_translation.disabled_firewalls%'
            - '@?security.firewall.map'
        tags:
            - { name: kernel.event_subscriber }
